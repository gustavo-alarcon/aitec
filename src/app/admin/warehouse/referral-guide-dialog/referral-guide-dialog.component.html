
 <div class="w3-row">
    <div [formGroup]="guideFormGroup">

      <div class="arrival">
        <mat-form-field class="w3-block w3-small size-item" appearance="outline">
          <mat-label>Codigo de pedido / operación</mat-label>
          <input matInput type="text" formControlName="codigo" placeholder="Codigo de pedido" autocomplete="off">
          <mat-error>  Requerido * </mat-error>
        </mat-form-field>

        <mat-form-field class="w3-block w3-small size-item" appearance="outline">
          <mat-label>Destinatario</mat-label>
          <input matInput type="text" formControlName="Addressee" placeholder="Destinatario" autocomplete="off">
          <mat-error>  Requerido * </mat-error>
        </mat-form-field>

        <mat-form-field class="w3-block w3-small size-item" appearance="outline">
          <mat-label>RUC / DNI</mat-label>
          <input matInput type="number" formControlName="dni" placeholder="RUC / DNI" autocomplete="off">
          <mat-error>  Requerido * </mat-error>
        </mat-form-field>

        <mat-form-field class="w3-block w3-small size-item"  appearance="outline">
          <mat-label>Fecha de Translado</mat-label>
          <input matInput [matDatepicker]="picker" [formControl]="guideFormGroup.get('startDate')">
          <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
          <mat-datepicker #picker></mat-datepicker>
        </mat-form-field>
        
        
        <mat-form-field class="w3-block w3-small size-item" appearance="outline">
          <mat-label>Punto de partida </mat-label>
          <input matInput type="text" formControlName="point" placeholder="Punto de partida" autocomplete="off">
          <mat-error>  Requerido * </mat-error>
        </mat-form-field>
        
        <mat-form-field class="w3-block w3-small size-item" appearance="outline">
          <mat-label>Punto de llegada</mat-label>
          <input matInput type="text" formControlName="arrivalPoint" placeholder="Punto de llegada" autocomplete="off">
          <mat-error>  Requerido * </mat-error>
        </mat-form-field>

      </div>

      <div class="relocated">
        <p>motivo de translado</p>
        <div class="container-relocated">
          <mat-radio-group aria-label="Seleccione una opción" formControlName="translate" color="primary">
            <div class="grid-relocated">
              <mat-radio-button class="w3-small w3-margin-right item" value="1">Ventas</mat-radio-button>
              <mat-radio-button class="w3-small w3-margin-right item" value="2">Translado de establecimiento de la misma empresa</mat-radio-button>
              <mat-radio-button class="w3-small w3-margin-right item" value="3">Importación</mat-radio-button>
              <mat-radio-button class="w3-small w3-margin-right item" value="4">Venta sujeto a confirmacion del comprador</mat-radio-button>
              <mat-radio-button class="w3-small w3-margin-right item" value="5">Translado de bienes para transformacion</mat-radio-button>
              <mat-radio-button class="w3-small w3-margin-right item" value="6">Exportación</mat-radio-button>
              <mat-radio-button class="w3-small w3-margin-right item" value="7">Compra</mat-radio-button>
              <mat-radio-button class="w3-small w3-margin-right item" value="8">Recojo de bines</mat-radio-button>
              <mat-radio-button class="w3-small w3-margin-right item" value="9">Venta con entrega a terceros</mat-radio-button>
              <mat-radio-button class="w3-small w3-margin-right item" value="10">Consignación</mat-radio-button>
              <mat-radio-button class="w3-small w3-margin-right item" value="11">Translado por emison de itenerante de comprobante de pago</mat-radio-button>
              <mat-radio-button class="w3-small w3-margin-right item" value="12">Otros no incluidos en los puntos anteriores tales como <br>
              exhibición, demostración, etc.</mat-radio-button>
              <mat-radio-button class="w3-small w3-margin-right item" value="13">Devolución</mat-radio-button>
              <mat-radio-button class="w3-small w3-margin-right item" value="14">Translado de zona primaria</mat-radio-button>
            </div>
          </mat-radio-group>          
        </div>
      </div> 
      <br>
      <br>
      <div class="observations">
        <p>Observaciones</p>
        <mat-form-field class="w3-block w3-small " appearance="outline">
          <mat-label>Observaciones</mat-label>
          <input matInput type="text" formControlName="oservations" placeholder="Observaciones" autocomplete="off">
          <mat-error>  Requerido * </mat-error>
        </mat-form-field>
      </div>

      <div class="transported">
        <p>Datos del bien transportados</p>

        <mat-form-field color="primary" class="w3-block w3-small size-item" appearance="outline">
          <mat-label>Almacén</mat-label>
          <mat-select [formControl]="entryWarehouseControl">
            <mat-option *ngFor="let item of warehouses$ | async" [value]="item">
              {{item.name}}
            </mat-option>
          </mat-select>
          <mat-hint>Seleccione un almacén</mat-hint>
          <mat-error>* Campo requerido</mat-error>
        </mat-form-field>

        <div class="products">
          
          <mat-form-field *ngIf=" entryProducts$ | async as products" color="primary" class="w3-block w3-small " appearance="outline">
            <mat-label>Producto</mat-label>
            <input [formControl]="entryProductControl" matInput type="text" [matAutocomplete]="autoProducts"
              placeholder="Escriba..." autocomplete="off">
            <mat-autocomplete #autoProducts="matAutocomplete" [displayWith]="showEntryProduct" 
              (optionSelected)="selectedEntryProduct($event)" > 
              <mat-option *ngFor="let product of products" style="font-size: 12px;" [value]="product">{{product.description}}
              </mat-option>
            </mat-autocomplete>
            <mat-hint>Escriba y seleccione un producto</mat-hint>
            <mat-error>* Campo requerido</mat-error>
          </mat-form-field>          

          <mat-form-field class="w3-block w3-small size-item" appearance="outline"> 
            <mat-label>Cantidad</mat-label>
            <input [formControl]="entryQuantitycontrol" matInput type="number" readonly placeholder="Escriba..." autocomplete="off">
          </mat-form-field>

          <mat-form-field *ngIf=" entrySeries$ | async as series" color="primary" class="w3-block w3-small " appearance="outline">
            <mat-label>Series</mat-label>
            <input [formControl]="entrySeries" matInput type="text" [matAutocomplete]="autoSeries"
              placeholder="Escriba..." autocomplete="off" (keyup.enter)="addSeries(entrySeries.value)">
            <mat-autocomplete #autoSeries="matAutocomplete" [displayWith]="showEntrySerial"
               > <!-- (optionSelected)="selectedEntryProduct($event)" -->
              <mat-option *ngFor="let serie of series" style="font-size: 12px;"
                [value]="serie">{{serie.barcode}}</mat-option>
            </mat-autocomplete>
            <mat-hint>Escriba y seleccione un serie</mat-hint>
            <mat-hint>Presione ENTER para agregar</mat-hint>
            <!-- <mat-error>* Campo requerido</mat-error> -->
            <!-- <mat-error *ngIf="existSerie">
              asdadasd
              <span>
                 ya existe en este almacén.
              </span>                
            </mat-error> -->
            <mat-error>
              <span>
                {{entrySeries.value}} ya existe en este almacén.</span>
                {{entrySeries$ | async}}
            </mat-error>
          </mat-form-field>
           
          <div>
            <div *ngIf="selectedProduct$ | async as product;" style="display: block;" class="info info--default ms-fill">
              <strong> {{product.description}}</strong>
            </div> 

            <table class="table table-striped">
              <thead>
                <tr class="grid-listProduct">
                  <th></th>
                  <th></th>
                  <th></th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let item of arraySeries; let i=index" class="grid-listProduct">
                  <td> {{i}} </td>
                  <td> {{item.name}} </td>        
                  <td> <i class="material-icons" (click)="deleteSerie(item)" style="cursor: pointer;">remove_circle</i></td>                      
                </tr>		      
              </tbody>
            </table>
          </div>                
        </div>

      </div>
      <div *ngIf="selectedProduct$ | async as product;" style="display: block;" class="info info--default ms-fill">
        <mat-dialog-actions align="center" >
          <button mat-raised-button color="primary" class="btn" (click)="addProducts(product)">Agregar</button>
        </mat-dialog-actions>
      </div>
    </div>
  </div>
  <br/>
  <mat-divider></mat-divider>

  <div class="listProduct">
  <p style="font-weight: bold;">Lista de productos</p>
  
  <table class="table table-striped">
    <thead>
      <tr class="grid-listProduct">
        <th>Nr°</th>
        <th>Codigo de Producto</th>
        <th>Producto</th>
        <th>Nr° de Series</th>
        <th>unidades</th>
        <th>und de medida</th>
        <th>total</th>
        <th>Acciones</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let item of arrayProducts; let i=index" class="grid-listProduct">
        <td> {{i}} </td>
        <td>{{item.code}}</td>
        <td> {{item.name}} </td>
        <td >{{item.series}}</td>
        <td> {{ item.quantity }} und</td>
        <td>{{item.und}}</td>
        <td>{{item.weight}}</td>

        <td> <i class="material-icons" (click)="deleteProduct(item)" style="cursor: pointer;">remove_circle</i></td>                           
      </tr>		      
    </tbody>
  </table>
  </div>  

<mat-progress-bar mode="indeterminate" *ngIf="loading$ | async" color="accent"></mat-progress-bar>
<div *ngIf="arrayProducts.length>0">
  <mat-dialog-actions align="center" > 
      <button mat-raised-button color="primary" class="btn" [disabled]="!guideFormGroup.valid" (click)="saveReferral()">Guardar</button>
      <button mat-raised-button color="primary" class="btn" printSectionId="print-section" ngxPrint > Imprimir</button>  
  </mat-dialog-actions> 
</div>

<div id="print-section" style="transform: scale(0.01); margin: 10px 10px 10px 30px;">
  <div style="margin: 20px 10px 10px 10px; width: 100%;">
    <div style="height: 200px;">
       <h2 style="position: absolute; top: 150px; right: 150px;">{{this.guideFormGroup.get('codigo').value}}</h2>
      
    </div>
    <div style="margin-left: 270px; display: grid; grid-column-gap: 2em; grid-template-columns: 1fr 1fr;">
      <p>{{this.guideFormGroup.get('Addressee').value}}</p>
      <p>{{this.guideFormGroup.get('dni').value}}</p>
      <p>{{this.guideFormGroup.get('arrivalPoint').value}}</p>
      <p>{{this.guideFormGroup.get('startDate').value * 1000 | date: "dd/MM/yyyy"}}</p>
      <p>{{this.guideFormGroup.get('point').value}}</p>
      <p>{{this.guideFormGroup.get('startDate').value * 1000 | date: "dd/MM/yyyy"}}</p>       
    </div>
  </div>
  <div style="margin: 20px 10px 10px 10px; width: 100%; height: 200px;">
    <div >
     <table >
       <thead>
         <tr >
           <th ></th>
           <th ></th>
           <th ></th>
           <th ></th>
           <th ></th>  
           <th ></th>
           <th ></th>
         </tr>
       </thead>
       <tbody >
         <tr *ngFor="let item of arrayProducts; let i=index">
           <td style="width:30px" > {{i}} </td>
           <td style="width:80px" >{{item.code}}</td>
           <td style="width:200px" > {{item.name}} </td>
           <td style="width:150px" >{{item.series}}</td>
           <td style="width:50px" > {{ item.quantity }} und</td>
           <td style="width:50px" >{{item.und}}</td>
           <td style="width:50px" >{{item.weight}}</td>                       
         </tr>		      
       </tbody>
     </table>
    </div>
  </div>
  <div style="margin: 20px 10px 10px 10px; width: 100%;">
    <div style="margin-left: 100px; display: grid; grid-column-gap: 1em; grid-template-columns: 1fr 1fr 1fr;">
      <p > {{this.guideFormGroup.get('translate').value=== '1' ? 'X': ' '}}  </p>      
      <p > {{this.guideFormGroup.get('translate').value=== '2' ? 'X' :' '}}  </p>      
      <p > {{this.guideFormGroup.get('translate').value=== '3' ? 'X' :' '}}  </p>       
      <p > {{this.guideFormGroup.get('translate').value=== '4' ? 'X' :' '}}  </p>      
      <p > {{this.guideFormGroup.get('translate').value=== '5' ? 'X' :' '}}  </p>      
      <p > {{this.guideFormGroup.get('translate').value=== '6' ? 'X' :' '}}  </p>      
      <p > {{this.guideFormGroup.get('translate').value=== '7' ? 'X' :' '}}  </p>       
      <p > {{this.guideFormGroup.get('translate').value=== '8' ? 'X' :' '}}  </p>      
      <p > {{this.guideFormGroup.get('translate').value=== '9' ? 'X' :' '}}  </p>      
      <p > {{this.guideFormGroup.get('translate').value==='10' ? 'X' :' '}}  </p>      
      <p > {{this.guideFormGroup.get('translate').value==='11' ? 'X' :' '}}  </p>      
      <p > {{this.guideFormGroup.get('translate').value==='12' ? 'X' :' '}}  </p>      
      <p > {{this.guideFormGroup.get('translate').value==='13' ? 'X' :' '}}  </p>      
      <p > {{this.guideFormGroup.get('translate').value==='14' ? 'X' :' '}}  </p>      
    </div>
    <div> 
      <textarea style="width: 350px; height: 100px; border: transparent ;">
        {{this.guideFormGroup.get('oservations').value}}
      </textarea>
    </div>
    
  </div>
</div>    
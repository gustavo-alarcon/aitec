<div class="w3-row">
  <div class="w3-col l8 col-md-7">
    <mat-card class="w3-block delivery"*ngIf="initDelivery$ | async">
      <h4 class="delivery__title w3-center">
        Por favor registra tus datos y verifícalos
      </h4>
      <form [formGroup]="formGroup" class="w3-margin-top">
        <mat-form-field class="w3-block" appearance="outline">
          <mat-label>Departamento</mat-label>
          <input type="text" placeholder="Departamento" matInput formControlName="departamento"
            [matAutocomplete]="autoD" />
          <mat-autocomplete autoActiveFirstOption #autoD="matAutocomplete" [displayWith]="showDepartamento">
            <mat-option *ngFor="let option of filteredDepartamento$ | async" [value]="option">
              {{ option.departamento | titlecase }}
            </mat-option>
          </mat-autocomplete>
          <mat-icon matSuffix>keyboard_arrow_down</mat-icon>
        </mat-form-field>
        <mat-form-field class="w3-block" appearance="outline" *ngIf="provincias$|async">
          <mat-label>Provincia</mat-label>
          <input type="text" placeholder="Provincia" matInput formControlName="provincia" [matAutocomplete]="autoP" />
          <mat-autocomplete autoActiveFirstOption #autoP="matAutocomplete" [displayWith]="showProvincia">
            <mat-option *ngFor="let option of filteredProvincia$ | async" [value]="option">
              {{ option.provincia | titlecase }}
            </mat-option>
          </mat-autocomplete>
          <mat-icon matSuffix>keyboard_arrow_down</mat-icon>
        </mat-form-field>
        <mat-form-field class="w3-block" appearance="outline" *ngIf="distritos$|async">
          <mat-label>Distrito</mat-label>
          <input type="text" placeholder="Distrito" matInput formControlName="distrito" [matAutocomplete]="autoX" />
          <mat-autocomplete autoActiveFirstOption #autoX="matAutocomplete" [displayWith]="showDistrito">
            <mat-option *ngFor="let option of filteredDistrito$ | async" [value]="option"
              (click)="selectDelivery(option)">
              {{ option.distrito | titlecase }}
            </mat-option>
          </mat-autocomplete>
          <mat-icon matSuffix>keyboard_arrow_down</mat-icon>
        </mat-form-field>
      </form>
      <div class="menuContainer">
        <div (click)="change()" [ngClass]="{'activated': viewBol, 'deactivated': !viewBol}">
          Entrega en domicilio
        </div>
        <div (click)="change()" [ngClass]="{'activated': !viewBol, 'deactivated': viewBol}">
          Recojo en tienda
        </div>
      </div>
      <div *ngIf="viewBol">
        <div *ngIf="auth.user$ | async as user" class="w3-block">
          <mat-card class="w3-margin-bottom">
            <mat-card-header>
              <mat-card-title style="font-size: 1em">
                <mat-icon style="vertical-align: middle">place</mat-icon>
                ¿En dónde recibirás tu pedido?
              </mat-card-title>
            </mat-card-header>
            <mat-card-content>
              <hr style="margin-top: 0" />
              <button *ngIf="user.location" mat-button color="primary" (click)="openMap(user, true)">
                Editar dirección
              </button>
              <div class="w3-padding">
                <div class="local-option" *ngIf="user.location; else nolocation">
                  <div>
                    <strong>{{ user.location.address }}</strong>
                  </div>
                  <div>Referencia: {{ user.location.reference }}</div>
                </div>
                <ng-template #nolocation>
                  <div class="w3-center">
                    <button mat-button color="primary" (click)="openMap(user, false)">
                      Agregar dirección
                    </button>
                  </div>
                </ng-template>
              </div>
              <hr style="margin: 0" />
            </mat-card-content>
          </mat-card>
        </div>
      </div>
      <div *ngIf="!viewBol">
        <mat-selection-list #shoes [multiple]="false">
          <div mat-subheader>Tiendas</div>
          <mat-list-option [value]="1">
            <mat-icon mat-list-icon>location_on</mat-icon>
            <div mat-line>
              P.T. cayma Mz G Lt 4b of.401, 4to piso ( referencia a una cuadra
              de la plaza cayma)
            </div>
          </mat-list-option>
          <mat-list-option [value]="2">
            <mat-icon mat-list-icon>location_on</mat-icon>
            <div mat-line>
              P.T. cayma Mz G Lt 4b of.401, 4to piso ( referencia a una cuadra
              de la plaza cayma)
            </div>
          </mat-list-option>
        </mat-selection-list>
      </div>
      <!--mat-radio-group color="primary" [formControl]="deliveryForm">
        <mat-radio-button [value]="1"> Entrega en domicilio </mat-radio-button>
        <mat-radio-button class="w3-margin-left" [value]="2">
          Recojo en tienda
        </mat-radio-button>
      </mat-radio-group>
      <form [formGroup]="formGroup" class="w3-margin-top">
        <mat-form-field class="w3-block" appearance="outline">
          <mat-label>Departamento</mat-label>
          <input type="text" placeholder="Departamento" matInput formControlName="departamento"
            [matAutocomplete]="autoD" />
          <mat-autocomplete autoActiveFirstOption #autoD="matAutocomplete" [displayWith]="showDepartamento">
            <mat-option *ngFor="let option of filteredDepartamento$ | async" [value]="option">
              {{ option.departamento | titlecase }}
            </mat-option>
          </mat-autocomplete>
          <mat-icon matSuffix>keyboard_arrow_down</mat-icon>
        </mat-form-field>
        <mat-form-field class="w3-block" appearance="outline" *ngIf="provincias$|async">
          <mat-label>Provincia</mat-label>
          <input type="text" placeholder="Provincia" matInput formControlName="provincia" [matAutocomplete]="autoP" />
          <mat-autocomplete autoActiveFirstOption #autoP="matAutocomplete" [displayWith]="showProvincia">
            <mat-option *ngFor="let option of filteredProvincia$ | async" [value]="option">
              {{ option.provincia | titlecase }}
            </mat-option>
          </mat-autocomplete>
          <mat-icon matSuffix>keyboard_arrow_down</mat-icon>
        </mat-form-field>
        <mat-form-field class="w3-block" appearance="outline" *ngIf="distritos$|async">
          <mat-label>Distrito</mat-label>
          <input type="text" placeholder="Distrito" matInput formControlName="distrito" [matAutocomplete]="autoX" />
          <mat-autocomplete autoActiveFirstOption #autoX="matAutocomplete" [displayWith]="showDistrito">
            <mat-option *ngFor="let option of filteredDistrito$ | async" [value]="option"
              (click)="selectDelivery(option)">
              {{ option.distrito | titlecase }}
            </mat-option>
          </mat-autocomplete>
          <mat-icon matSuffix>keyboard_arrow_down</mat-icon>
        </mat-form-field>
        <div *ngIf="(chooseDelivery$|async) == 1">
          <mat-form-field class="w3-block" appearance="outline">
            <mat-label>Dirección</mat-label>
            <input autocomplete="off" formControlName="direccion" matInput placeholder="Teléfono" />
          </mat-form-field>

          <mat-form-field class="w3-block" appearance="outline">
            <mat-label>Referencia</mat-label>
            <input autocomplete="off" formControlName="referencia" type="tel" matInput placeholder="Teléfono" />
          </mat-form-field>
          <div class="w3-margin-bottom w3-margin-top">
            <div style="display: flex; flex-wrap: wrap; justify-content: space-between">
              <div style="width: 80%">
                Especifica tu dirección en el mapa (Opcional)
              </div>
              <button mat-icon-button color="primary" (click)="findMe()">
                <mat-icon>gps_fixed</mat-icon>
              </button>
            </div>
            <br />
            <google-map height="280px" width="100%" (mapClick)="mapClicked($event)" [center]="center" [zoom]="zoom">
              <map-marker [position]="center"></map-marker>
            </google-map>
          </div>
        </div>
        <div *ngIf="delivery == 2">
          <div>
            <mat-selection-list #shoes [multiple]="false">
              <div mat-subheader>Tiendas</div>
              <mat-list-option [value]="1">
                <mat-icon mat-list-icon>location_on</mat-icon>
                <div mat-line>
                  P.T. cayma Mz G Lt 4b of.401, 4to piso ( referencia a una cuadra
                  de la plaza cayma)
                </div>
              </mat-list-option>
              <mat-list-option [value]="2">
                <mat-icon mat-list-icon>location_on</mat-icon>
                <div mat-line>
                  P.T. cayma Mz G Lt 4b of.401, 4to piso ( referencia a una cuadra
                  de la plaza cayma)
                </div>
              </mat-list-option>
            </mat-selection-list>
          </div>
        </div>
      </form-->
    </mat-card>
  </div>
  <div class="w3-col l4 col-md-5">
    <div class="resume">
      <h2 class="resume__title">Resumen de pedido</h2>
      <div class="resume__divider"></div>
      <div class="resume__list w3-section">
        <div style="display: flex; flex-wrap: wrap; margin-bottom: 16px">
          <div style="width: 20%">Cant.</div>
          <div style="width: 55%">Descripción</div>
          <div style="width: 25%">Precio</div>
        </div>
        <div *ngFor="let prod of dbs.order" style="display: flex; flex-wrap: wrap; align-items: center">
          <div style="width: 20%" class="w3-center">
            {{prod.quantity | number:'2.'}}
          </div>
          <div style="width: 55%">
            {{prod.product.description}}
          </div>
          <div style="width: 25%">
            S/. {{getPrice(prod) | number:'.2'}}
          </div>

        </div>
      </div>
      <div class="resume__divider"></div>
      <div class="resume__descrip w3-section">
        <div class="ms-flex ms-flex--center">
          <span>Subtotal</span>
          <span class="ms-fill"></span>
          <span>25.00</span>
        </div>
        <div class="ms-flex ms-flex--center">
          <span>Cargos adicionales</span>
          <span class="ms-fill"></span>
          <span>0.00</span>
        </div>
        <div class="ms-flex ms-flex--center">
          <span>Descuento promocional</span>
          <span class="ms-fill"></span>
          <span>20.00</span>
        </div>
        <div class="ms-flex ms-flex--center">
          <span>IGV</span>
          <span class="ms-fill"></span>
          <span>60.00</span>
        </div>
        <div class="ms-flex ms-flex--center">
          <span>Delivery</span>
          <span class="ms-fill"></span>
          <span>7.00</span>
        </div>
      </div>
      <div class="resume__divider"></div>
      <div style="display: flex; margin-top: 20px;justify-content: space-between;">
        <div><strong>Total a pagar:</strong></div>
        <div class="ticket__total">
          S/. 1040.00
        </div>
      </div>
      <div class="w3-margin-bottom">
        <h4 class="resume__subtitle">Comentario adicional</h4>
        <mat-form-field class="w3-block" appearance="outline">
          <textarea autocomplete="off" type="tel" matInput placeholder="Escriba.." rows="3"></textarea>
        </mat-form-field>
        <p class="resume__small">*Puedes dejar un comentario adicional para tenerlo en cuenta al generar tu pedido
        </p>
      </div>
      <div class="w3-center w3-margin-bottom">
        <button mat-raised-button color="primary" class="resume__button" (click)="sendInfo()">
          Generar orden de pedido
        </button>
      </div>
      <p class="resume__small">*Con la aceptación del pedido, usted confirma la compra del mismo</p>

    </div>
  </div>
</div>
